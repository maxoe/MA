% !TeX root = thesis.tex
%% evaluation.tex
%%

%% ==============
\chapter{Evaluation\label{ch:Evaluation}}
\section{Theoretical Complexity}
TODO is multi-criteria spp with travel time and the time since last break as criteria, optimal multi-criteria path is not prefix optimal  \cite{tuin:2018}

according to \cite{hansen:1980} np-hard

\section{Experiments}
In this Section, we evaluate the running time and behavior of our algorithms of chapter~\ref{ch:Algorithm} in various experiments and describe the underlying data. Our machine runs openSUSE Leap 15.3, has \SI{128}{\giga\byte} (8x\SI{16}{\giga\byte}) of \SI{2133}{\mega\hertz} DDR4 RAM, and a 4-core Intel Xeon E5-1630v3 CPU which runs at \SI{3.7}{\giga\hertz}. The code is written in Rust and compiled with cargo 1.59.0-nightly using the release profile with lto~=~true and codegen-units~=~1.

\subparagraph{Data.} Our data is a road network of Europe from Open Street Map\footnote{\url{https://download.geofabrik.de/europe-latest.osm.pbf} of March 22, 2022} (OSM). We extract the routing graph from the OSM data using RoutingKit\footnote{\url{https://github.com/RoutingKit/RoutingKit}}, respectively a custom extension\footnote{\url{https://github.com/maxoe/RoutingKit}} of RoutingKit which is capable of extracting parking nodes accordingly and building the core CH as described in Section \ref{sec:build_corech}. The obtained routing graph has $81.5$ million nodes and $190$ million edges. If not stated otherwise, our set $P$ of parking nodes consists of 6800 nodes which were selected due to their OSM attributes. We will later conduct experiments with different choices for $P$.

\subparagraph{Methodology.} All experiments are run sequentially. We conduct experiments regarding the preprocessing time of the OSM data and the running time of queries on the extracted routing graph. We average preprocessing running times over \num{10} runs and running times of $s$-$t$ queries over \num{10000} queries with $s$ and $t$ independently chosen uniformly at random for each query. If not stated otherwise, we use $\restr_1$ with $\restr_1^d = \SI{4.5}{\hour}$ and $\restr_1^b = \SI{0.45}{\minute}$ and $\restr_2$ with $\restr_2^d = \SI{9}{\hour}$ and $\restr_2^b = \SI{9}{\hour}$ to approximate the regulations of the EU.

\subsection{Comparison of Algorithms and Optimizations}
We evaluate the different algorithms of chapter \ref{ch:Algorithm} and the optimizations of chapter \refeq{ch:impl}.

First, we compare the running times of queries of the algorithms of chapter \ref{ch:Algorithm} on a German road network which was obtained in the exact same way from OSM as the European road network\footnote{\url{https://download.geofabrik.de/europe/germany-latest.osm.pbf} of March 22, 2022}. We scale the experiment down from the European road network because some variants of the algorithms in this experiment cannot keep up with the performance of the goal-directed core CH algorithm and would render the experiment slow and impracticable. To avoid distortions, we also scale down the driving time constraints. Otherwise, most random $s$-$t$ queries on the German road network would be to short to require a break and almost no query would require more than one break. TODO

As Table \ref{tbl:extensions_runtime} shows, the goal-directed search already performs an order of magnitude better than the baseline Dijkstra's algorithm with our amendments for driving time constraints. TODO bidir. The largest improvement brings the bidirectional search which improves the baseline by a factor of about \num{10000} and the goal-directed variant by a factor of about \num{1000}.

\begin{table}[hbtp]
	\centering
	\input{gen/eval_running_times_all.tex}
	\caption{Running times of random queries on a German road network}
	\label{tbl:extensions_runtime}
\end{table}

Most of the performance gain of the goal-directed search originates from the very tight lower-bound given by the CH potentials. If the shortest travel time between two nodes $s$ and $t$ is way larger than $\distance(s,t)$ due to necessary breaks and even detours to parking nodes on the route, then the performance of the goal-directed search degrades. The bidirectional variant can mitigate this disadvantage since it connects two routes which each for itself have fewer breaks on the route. A disadvantage from the goal-directed search which cannot be mitigated by the bidirectional variant are its outliers. In cases where the algorithm is not able to find a route or the route needs a lot of breaks, the running time increases significantly. TODO

TODO outlier problem with graphics leas to non ch excluded even if fast
\begin{table}[hbtp]
	\centering
	\input{gen/eval_running_times_fast.tex}
	\caption{Running times of random queries on a European road network}
	\label{tbl:extensions_runtime_eur}
\end{table}

Second, we evaluate the different optimizations as described in chapter \refeq{ch:impl} in use with the goal-directed core CH algorithm on the European road network.

\begin{table}[hbtp]
	\centering
	\input{gen/eval_running_times_opt.tex}
	\caption{Comparison of running times of the goal-directed core CH algorithm with different optimizations from Section\ref{ch:impl}.}
	\label{tbl:opt_runtime}
\end{table}

\subsection{Study of Goal-Directed Core CH Queries}
Finally, we investigate queries of the goal-directed core CH algorithm with full optimizations more closely. What drives the running time of the algorithm? TODO

\begin{figure}[hbtp]
	\centering
	\includegraphics[width=.95\textwidth]{plots/measure_all_csp_2_1000_queries_rank_times-core_ch_chpot-time_ms.png}
	\caption{Running times of the goal-directed core CH algorithm for queries to nodes of increasing Dijkstra rank, logarithmic scales.}
	\label{fig:rank_times}
\end{figure}

\begin{itemize}
	\item different $\len$
	\item variable break time, driving time limit
	\item parking node set
\end{itemize}
